(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{60163:function(e,t,n){Promise.resolve().then(n.bind(n,75975))},75975:function(e,t,n){"use strict";n.d(t,{default:function(){return c}});var a=n(57437),r=n(88726),i=n(2265),s=n(16463);async function l(e){let t=new TextEncoder;return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t.encode(e)))).map(e=>e.toString(16).padStart(2,"0")).join("")}async function o(){try{var e,t,n,a,r,i;navigator;let s=[navigator.userAgent||"",navigator.language||"",navigator.platform||"",navigator.vendor||"",String((null===(e=screen)||void 0===e?void 0:e.width)||0)+"x"+String((null===(t=screen)||void 0===t?void 0:t.height)||0),String((null===(n=screen)||void 0===n?void 0:n.colorDepth)||0),String(navigator.hardwareConcurrency||0),String(navigator.deviceMemory||0),(null===(i=Intl)||void 0===i?void 0:null===(r=i.DateTimeFormat())||void 0===r?void 0:null===(a=r.resolvedOptions())||void 0===a?void 0:a.timeZone)||"",function(){try{let e=document.createElement("canvas"),t=e.getContext("2d");if(e.width=200,e.height=50,!t)return"";return t.textBaseline="top",t.font="14px 'Arial'",t.fillStyle="#f60",t.fillRect(125,1,62,20),t.fillStyle="#069",t.fillText("fingerprint",2,15),t.fillStyle="rgba(102, 204, 0, 0.7)",t.fillText("fingerprint",4,17),e.toDataURL()}catch(e){return""}}()].join("||");return await l(s)}catch(e){return String(Math.random()).slice(2)}}function c(e){let{slug:t}=e,n=(0,s.useRouter)(),[l,c]=(0,i.useState)(!0),[u,d]=(0,i.useState)(!1),[p,h]=(0,i.useState)([]),[f,v]=(0,i.useState)({}),[g,m]=(0,i.useState)(!1),[y,x]=(0,i.useState)("device"),[j,b]=(0,i.useState)(!1),[S,k]=(0,i.useState)(!1),[w,N]=(0,i.useState)(""),[P,C]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{var e,t;try{let t=null!==(e=localStorage.getItem("surveysUFG_token"))&&void 0!==e?e:"";t||(t=crypto.randomUUID(),localStorage.setItem("surveysUFG_token",t)),N(t)}catch(e){N(Math.random().toString(36).slice(2))}try{let e=null!==(t=localStorage.getItem("surveysUFG_fp"))&&void 0!==t?t:"";e||(e=await o(),localStorage.setItem("surveysUFG_fp",e)),C(e)}catch(e){C("")}})()},[]),(0,i.useEffect)(()=>{(async()=>{var e;if(!w&&"device"===y)return;c(!0);let n=await fetch("/api/public/s/".concat(t));if(!n.ok){c(!1),r.ZP.error("No se pudo cargar la encuesta");return}h((await n.json()).questions);let a=new URLSearchParams;w&&a.set("token",w),P&&a.set("fp",P);let i=await fetch("/api/public/s/".concat(t,"/my-status?").concat(a.toString())),s=await i.json();m(!!s.singleResponse),x(null!==(e=s.scope)&&void 0!==e?e:"device"),b(!!s.alreadyResponded),k(!!s.requiresLogin),c(!1)})()},[t,w,P]);let _=(e,t)=>{v(n=>({...n,[e]:t}))},A=async e=>{if(e.preventDefault(),u)return;if(g&&j){r.ZP.error("Ya enviaste una respuesta para esta encuesta"),n.push("/s/".concat(t,"/thanks?already=1"));return}if(g&&"user"===y&&S){r.ZP.error("Inicia sesi\xf3n para responder esta encuesta"),n.push("/auth/login?redirect=/s/".concat(t));return}for(let e of p)if(e.required){let t=f[e.id];if(null==t||"string"==typeof t&&""===t.trim()||Array.isArray(t)&&0===t.length){r.ZP.error("Responde todas las preguntas obligatorias");return}}d(!0);let a={respondentToken:w,respondentFp:P,answers:Object.entries(f).map(e=>{let[t,n]=e;return{questionId:t,value:n}})},i=await fetch("/api/public/s/".concat(t,"/responses"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){let e=await i.json().catch(()=>({}));if((null==e?void 0:e.error)==="already_answered"){d(!1),n.push("/s/".concat(t,"/thanks?already=1"));return}if((null==e?void 0:e.error)==="login_required"){d(!1),n.push("/auth/login?redirect=/s/".concat(t));return}r.ZP.error(e.error||"No se pudo enviar la respuesta"),d(!1);return}n.push("/s/".concat(t,"/thanks"))};return l?(0,a.jsx)("div",{className:"card",children:(0,a.jsx)("p",{children:"Cargando…"})}):g&&j?(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("p",{children:"Ya enviaste una respuesta para esta encuesta."}),(0,a.jsx)("button",{className:"btn",onClick:()=>n.push("/s/".concat(t,"/thanks?already=1")),children:"Ver mensaje"})]}):p.length?(0,a.jsxs)("form",{onSubmit:A,className:"card",style:{marginTop:".8rem"},children:[(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:p.map(e=>{var t;return(0,a.jsxs)("div",{style:{textAlign:"left"},children:[(0,a.jsxs)("label",{style:{fontWeight:600,display:"inline-flex",alignItems:"center",gap:".5rem"},children:[(0,a.jsx)("span",{children:e.question_text}),e.required?(0,a.jsx)("span",{className:"badge",children:"Obligatoria"}):null]}),"text"===e.type&&(0,a.jsx)("textarea",{rows:3,value:null!==(t=f[e.id])&&void 0!==t?t:"",onChange:t=>_(e.id,t.target.value),style:{width:"100%"}}),"single"===e.type&&(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:".35rem"},children:e.options.map((t,n)=>{var r;let i=null!==(r=t.value)&&void 0!==r?r:t.label;return(0,a.jsxs)("label",{className:"inline-option",children:[(0,a.jsx)("input",{type:"radio",name:e.id,checked:f[e.id]===i,onChange:()=>_(e.id,i)}),(0,a.jsx)("span",{children:t.label})]},n)})}),("multiple"===e.type||"checkbox"===e.type)&&(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:".35rem"},children:e.options.map((t,n)=>{var r;let i=null!==(r=t.value)&&void 0!==r?r:t.label,s=Array.isArray(f[e.id])?f[e.id]:[],l=s.includes(i);return(0,a.jsxs)("label",{className:"inline-option",children:[(0,a.jsx)("input",{type:"checkbox",checked:l,onChange:t=>{t.target.checked?_(e.id,[...s,i]):_(e.id,s.filter(e=>e!==i))}}),(0,a.jsx)("span",{children:t.label})]},n)})}),"likert"===e.type&&(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:".35rem"},children:e.options.map((t,n)=>{var r;let i=null!==(r=t.value)&&void 0!==r?r:t.label;return(0,a.jsxs)("label",{className:"inline-option",children:[(0,a.jsx)("input",{type:"radio",name:e.id,checked:f[e.id]===i,onChange:()=>_(e.id,i)}),(0,a.jsx)("span",{children:t.label})]},n)})})]},e.id)})}),(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem",gap:".5rem"},children:[(0,a.jsx)("button",{className:"btn primary",type:"submit",disabled:u,children:u?"Enviando…":"Enviar"}),(0,a.jsx)("button",{className:"btn danger",type:"reset",onClick:()=>v({}),disabled:u,children:"Limpiar"})]})]}):(0,a.jsx)("div",{className:"card",children:(0,a.jsx)("p",{children:"Esta encuesta no tiene preguntas."})})}},16463:function(e,t,n){"use strict";var a=n(71169);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[726,971,23,744],function(){return e(e.s=60163)}),_N_E=e.O()}]);