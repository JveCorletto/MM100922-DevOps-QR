"use strict";(()=>{var e={};e.id=345,e.ids=[345],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},21132:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>c});var t={};r.r(t),r.d(t,{POST:()=>u});var n=r(49303),o=r(88716),i=r(60670),a=r(87070),p=r(30474);async function u(e,{params:s}){let r=(0,p.R)(),t=await e.json().catch(()=>({})),n=t?.answers??[],o="string"==typeof t?.respondentToken?t.respondentToken:"",i="string"==typeof t?.respondentFp?t.respondentFp:"",{data:{user:u}}=await r.auth.getUser(),{data:l,error:d}=await r.from("surveys").select("id, status, single_response, single_response_scope").eq("slug",s.slug).single();if(d||!l)return a.NextResponse.json({error:"Encuesta no encontrada"},{status:404});if("published"!==l.status)return a.NextResponse.json({error:"Encuesta no disponible"},{status:410});if(l.single_response){if("user"===l.single_response_scope){if(!u)return a.NextResponse.json({error:"login_required"},{status:401});let{data:e}=await r.from("responses").select("id").eq("survey_id",l.id).eq("user_id",u.id).maybeSingle();if(e)return a.NextResponse.json({error:"already_answered"},{status:409})}else{if(!o&&!i)return a.NextResponse.json({error:"Se requiere token o fingerprint del dispositivo para respuestas \xfanicas por dispositivo"},{status:400});let e=!1;if(o){let{data:s}=await r.from("responses").select("id").eq("survey_id",l.id).eq("respondent_token",o).maybeSingle();s&&(e=!0)}if(!e&&i){let{data:s}=await r.from("responses").select("id").eq("survey_id",l.id).eq("respondent_fp",i).maybeSingle();s&&(e=!0)}if(e)return a.NextResponse.json({error:"already_answered"},{status:409})}}let{data:c,error:x}=await r.from("responses").insert({survey_id:l.id,respondent_token:o||null,respondent_fp:i||null,user_id:u?.id||null}).select("id").single();if(x)return"23505"===x.code&&x.message?.includes("uniq_resp_by_device")?a.NextResponse.json({error:"already_answered"},{status:409}):a.NextResponse.json({error:x.message},{status:400});let g=n.filter(e=>e&&e.questionId).map(e=>({response_id:c.id,question_id:e.questionId,value_json:e.value??null}));if(g.length){let{error:e}=await r.from("response_items").insert(g);if(e)return a.NextResponse.json({error:e.message},{status:400})}return a.NextResponse.json({ok:!0})}let l=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/public/s/[slug]/responses/route",pathname:"/api/public/s/[slug]/responses",filename:"route",bundlePath:"app/api/public/s/[slug]/responses/route"},resolvedPagePath:"C:\\Projects\\MM100922-DevOps-QR\\app\\api\\public\\s\\[slug]\\responses\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:x}=l,g="/api/public/s/[slug]/responses/route";function f(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:c})}},30474:(e,s,r)=>{r.d(s,{R:()=>o});var t=r(71615),n=r(16510);function o(){let e=(0,t.cookies)();return(0,n.createServerClient)("https://jfagkzxzkbslpohhojuh.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmYWdrenh6a2JzbHBvaGhvanVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0NDIyNjQsImV4cCI6MjA3ODAxODI2NH0.y8rKE8CyNK54GkqRRDalX5hyPy1YrG8NVj6mr2sgKPU",{cookies:{getAll:()=>e.getAll(),setAll(s){try{s.forEach(({name:s,value:r,options:t})=>{e.set(s,r,t)})}catch{}}}})}}};var s=require("../../../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[948,223,972],()=>r(21132));module.exports=t})();