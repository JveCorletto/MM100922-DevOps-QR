(()=>{var e={};e.id=328,e.ids=[328],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},20863:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>x,tree:()=>c}),s(88347),s(20445),s(35866);var r=s(23191),i=s(88716),n=s(37922),a=s.n(n),l=s(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["s",{children:["[slug]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,88347)),"C:\\Projects\\MM100922-DevOps-QR\\app\\s\\[slug]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,20445)),"C:\\Projects\\MM100922-DevOps-QR\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],u=["C:\\Projects\\MM100922-DevOps-QR\\app\\s\\[slug]\\page.tsx"],d="/s/[slug]/page",p={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/s/[slug]/page",pathname:"/s/[slug]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},43676:(e,t,s)=>{Promise.resolve().then(s.bind(s,3660))},3660:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var r=s(10326),i=s(40381),n=s(17577),a=s(35047);function l({slug:e}){let t=(0,a.useRouter)(),[s,l]=(0,n.useState)(!0),[o,c]=(0,n.useState)(!1),[u,d]=(0,n.useState)([]),[p,x]=(0,n.useState)({}),[h,m]=(0,n.useState)(!1),[g,y]=(0,n.useState)("device"),[j,f]=(0,n.useState)(!1),[b,v]=(0,n.useState)(!1),[q,P]=(0,n.useState)(""),[k,_]=(0,n.useState)(""),N=(e,t)=>{x(s=>({...s,[e]:t}))},C=async s=>{if(s.preventDefault(),o)return;if(h&&j){i.ZP.error("Ya enviaste una respuesta para esta encuesta"),t.push(`/s/${e}/thanks?already=1`);return}if(h&&"user"===g&&b){i.ZP.error("Inicia sesi\xf3n para responder esta encuesta"),t.push(`/auth/login?redirect=/s/${e}`);return}for(let e of u)if(e.required){let t=p[e.id];if(null==t||"string"==typeof t&&""===t.trim()||Array.isArray(t)&&0===t.length){i.ZP.error("Responde todas las preguntas obligatorias");return}}c(!0);let r={respondentToken:q,respondentFp:k,answers:Object.entries(p).map(([e,t])=>({questionId:e,value:t}))},n=await fetch(`/api/public/s/${e}/responses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!n.ok){let s=await n.json().catch(()=>({}));if(s?.error==="already_answered"){c(!1),t.push(`/s/${e}/thanks?already=1`);return}if(s?.error==="login_required"){c(!1),t.push(`/auth/login?redirect=/s/${e}`);return}i.ZP.error(s.error||"No se pudo enviar la respuesta"),c(!1);return}t.push(`/s/${e}/thanks`)};return s?r.jsx("div",{className:"card",children:r.jsx("p",{children:"Cargando…"})}):h&&j?(0,r.jsxs)("div",{className:"card",children:[r.jsx("p",{children:"Ya enviaste una respuesta para esta encuesta."}),r.jsx("button",{className:"btn",onClick:()=>t.push(`/s/${e}/thanks?already=1`),children:"Ver mensaje"})]}):u.length?(0,r.jsxs)("form",{onSubmit:C,className:"card",style:{marginTop:".8rem"},children:[r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:u.map(e=>(0,r.jsxs)("div",{style:{textAlign:"left"},children:[(0,r.jsxs)("label",{style:{fontWeight:600,display:"inline-flex",alignItems:"center",gap:".5rem"},children:[r.jsx("span",{children:e.question_text}),e.required?r.jsx("span",{className:"badge",children:"Obligatoria"}):null]}),"text"===e.type&&r.jsx("textarea",{rows:3,value:p[e.id]??"",onChange:t=>N(e.id,t.target.value),style:{width:"100%"}}),"single"===e.type&&r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:".35rem"},children:e.options.map((t,s)=>{let i=t.value??t.label;return(0,r.jsxs)("label",{className:"inline-option",children:[r.jsx("input",{type:"radio",name:e.id,checked:p[e.id]===i,onChange:()=>N(e.id,i)}),r.jsx("span",{children:t.label})]},s)})}),("multiple"===e.type||"checkbox"===e.type)&&r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:".35rem"},children:e.options.map((t,s)=>{let i=t.value??t.label,n=Array.isArray(p[e.id])?p[e.id]:[],a=n.includes(i);return(0,r.jsxs)("label",{className:"inline-option",children:[r.jsx("input",{type:"checkbox",checked:a,onChange:t=>{t.target.checked?N(e.id,[...n,i]):N(e.id,n.filter(e=>e!==i))}}),r.jsx("span",{children:t.label})]},s)})}),"likert"===e.type&&r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:".35rem"},children:e.options.map((t,s)=>{let i=t.value??t.label;return(0,r.jsxs)("label",{className:"inline-option",children:[r.jsx("input",{type:"radio",name:e.id,checked:p[e.id]===i,onChange:()=>N(e.id,i)}),r.jsx("span",{children:t.label})]},s)})})]},e.id))}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"1rem",gap:".5rem"},children:[r.jsx("button",{className:"btn primary",type:"submit",disabled:o,children:o?"Enviando…":"Enviar"}),r.jsx("button",{className:"btn danger",type:"reset",onClick:()=>x({}),disabled:o,children:"Limpiar"})]})]}):r.jsx("div",{className:"card",children:r.jsx("p",{children:"Esta encuesta no tiene preguntas."})})}},88347:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(19510),i=s(68570);let n=(0,i.createProxy)(String.raw`C:\Projects\MM100922-DevOps-QR\app\s\[slug]\public-client.tsx`),{__esModule:a,$$typeof:l}=n;n.default;let o=(0,i.createProxy)(String.raw`C:\Projects\MM100922-DevOps-QR\app\s\[slug]\public-client.tsx#default`);var c=s(30474),u=s(58585);async function d({params:e}){let t=(0,c.R)(),{data:s,error:i}=await t.from("surveys").select("id, title, description, status, slug").eq("slug",e.slug).single();return((i||!s)&&(0,u.notFound)(),"published"!==s.status)?(0,r.jsxs)("main",{className:"container card",children:[r.jsx("h1",{children:"Encuesta no disponible"}),r.jsx("p",{children:"Esta encuesta no est\xe1 publicada."})]}):(0,r.jsxs)("main",{className:"container section",children:[(0,r.jsxs)("section",{className:"card",children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-semibold",style:{margin:0,lineHeight:1.2},children:s.title}),s.description?r.jsx("p",{style:{marginTop:".5rem"},children:s.description}):null]}),r.jsx(o,{slug:e.slug})]})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,223,137,503],()=>s(20863));module.exports=r})();